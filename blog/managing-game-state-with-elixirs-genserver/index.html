<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 2.23.10"/><title data-react-helmet="true">Managing game state with Elixirs GenServer | Cain Watson</title><meta data-react-helmet="true" name="description" content="Portfolio of Cain Watson"/><meta data-react-helmet="true" property="og:title" content="Managing game state with Elixirs GenServer"/><meta data-react-helmet="true" property="og:description" content="Portfolio of Cain Watson"/><meta data-react-helmet="true" property="og:type" content="website"/><link rel="icon" href="/favicon-32x32.png?v=b88989dcdd1db3243030f4094e4a7075"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#011627"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=b88989dcdd1db3243030f4094e4a7075"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=b88989dcdd1db3243030f4094e4a7075"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=b88989dcdd1db3243030f4094e4a7075"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=b88989dcdd1db3243030f4094e4a7075"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=b88989dcdd1db3243030f4094e4a7075"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=b88989dcdd1db3243030f4094e4a7075"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=b88989dcdd1db3243030f4094e4a7075"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=b88989dcdd1db3243030f4094e4a7075"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="anonymous"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="https://fonts.gstatic.com/s/lexenddeca/v1/K2F1fZFYk-dHSE0UPPuwQ5qnJy8.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="https://fonts.gstatic.com/s/poppins/v11/pxiByp8kv8JHgFVrLEj6Z1xlFQ.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="https://fonts.gstatic.com/s/firamono/v8/N0bX2SlFPv1weGeLZDtgJv7S.woff2"/><style>@font-face{font-family:Lexend Deca;font-style:normal;font-weight:400;font-display:swap;src:local("Lexend Deca Regular"),local("LexendDeca-Regular"),url(https://fonts.gstatic.com/s/lexenddeca/v1/K2F1fZFYk-dHSE0UPPuwQ5qnJy8.woff2) format("woff2"),url(https://fonts.gstatic.com/s/lexenddeca/v1/K2F1fZFYk-dHSE0UPPuwQ5qnJyk.woff) format("woff")}@font-face{font-family:Poppins;font-weight:600;src:local("Poppins SemiBold"),local("Poppins-SemiBold"),url(https://fonts.gstatic.com/s/poppins/v11/pxiByp8kv8JHgFVrLEj6Z1xlFQ.woff2) format("woff2"),url(https://fonts.gstatic.com/s/poppins/v11/pxiByp8kv8JHgFVrLEj6Z1xlEw.woff) format("woff");font-family:Fira Mono;src:local("Fira Mono Regular"),local("FiraMono-Regular"),url(https://fonts.gstatic.com/s/firamono/v8/N0bX2SlFPv1weGeLZDtgJv7S.woff2) format("woff2"),url(https://fonts.gstatic.com/s/firamono/v8/N0bX2SlFPv1weGeLZDtgJv7U.woff) format("woff");font-family:Noto Sans SC;font-style:normal;font-weight:400;font-display:swap;src:local("Noto Sans SC Regular"),local("NotoSansSC-Regular"),url(https://fonts.gstatic.com/l/font?kit=k3kXo84MPvpLmixcA63oeALhLJCsEo98FhQ3_64mWB7rjWh7Gd3vFr_9ydxtsmnyx_WRUvOL&skey=cf0bb10b5602fdc3&v=v11) format("woff2"),url(https://fonts.gstatic.com/l/font?kit=k3kXo84MPvpLmixcA63oeALhKpCsEo98FhQ3_64mWB7rjWh7Gd3vFr_9ydxtsmnyx_WRUvOL&skey=cf0bb10b5602fdc3&v=v11) format("woff")}</style><link as="script" rel="preload" href="/webpack-runtime-d2068360cb1b0d995a3e.js"/><link as="script" rel="preload" href="/framework-5933964352f6dffb280b.js"/><link as="script" rel="preload" href="/app-306a27735be49c7b5cff.js"/><link as="script" rel="preload" href="/77f58fe8c39316444cad7dcd116feae7c17e2b2a-2b9cfe091b3485bf7db0.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-tsx-763dc3dcbf1587240ee1.js"/><link as="fetch" rel="preload" href="/page-data/blog/managing-game-state-with-elixirs-genserver/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion-css="1qla61d">*,*::before,*::after{box-sizing:border-box;}html{font-size:18px;}body{margin:0;font-family:'Lexend Deca',sans-serif;color:#011627;background-color:#FCEFF9;}main{position:relative;overflow-x:hidden;}h1,h2,h3,h4,h5,h6,button{font-family:'Poppins',sans-serif;}h1{font-size:1.89rem;margin:14px 0;}h2{font-size:1.56rem;margin:10px 0;}a{color:#011627;}</style><main><style data-emotion-css="1n67xyh">.css-1n67xyh{--grvsc-padding-h:0.9rem;--grvsc-padding-v:0.9rem;margin:0 auto;padding:20px;}.css-1n67xyh code{font-family:'Fira Mono',monospace;font-size:0.9rem;}.css-1n67xyh *:not(pre) > code{padding:2px 0.2em;color:#d6deeb;background-color:#011627;border:1px solid #011627;border-radius:6px;}@media (min-width:1024px){.css-1n67xyh{width:50%;}}</style><section class="css-1n67xyh eb8btzt0"><style data-emotion-css="i3pbo">.css-i3pbo{margin-bottom:24px;}</style><header class="css-i3pbo e17nyf3f0"><h1>Managing game state with Elixirs GenServer</h1><style data-emotion-css="wd8pcb">.css-wd8pcb{margin:-4px;padding:0;list-style-type:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}</style><ul class="css-wd8pcb e17nyf3f1"><style data-emotion-css="19nzs7d">.css-19nzs7d{margin:4px;padding:6px 8px;color:#FCEFF9;background-color:#011627;border-radius:6px;}</style><li class="css-19nzs7d e17nyf3f2">elixir</li></ul><style data-emotion-css="1wnoqiv">.css-1wnoqiv{margin:14px 0;}</style><div class="css-1wnoqiv e17nyf3f3"><time dateTime="2019-11-30T00:00:00.000Z" title="November 30, 2019">November 30, 2019</time><span> · <!-- -->2 min read</span></div></header><div><p>I've recently been working a project of mine called <a href="https://github.com/JustDrawIt/drawit/" target="_blank" rel="noopener noreferrer">Draw It!</a> It's a web-based, multiplayer game where a random player is assigned a word they must draw, while everyone else must figure out what the word is.</p>
<p>Originally, as an MVP, the main game logic was implemented with Node and good ol' <code>setTimeout</code>, however I recently discovered <a href="https://elixir-lang.org/" target="_blank" rel="noopener noreferrer">Elixir</a> and all the great tools it comes with out of the box for dealing with asynchronous and concurrent systems. I had some spare time and I wanted to get my hands dirty using this tool, so I decided to update the game logic to use Elixir.</p>
<p>I quickly discovered <a href="https://hexdocs.pm/elixir/GenServer.html" target="_blank" rel="noopener noreferrer">GenServer</a>, a helpful abstraction for creating processes that can run code asynchronously and maintain state.</p>
<p>First things first, we need a module that we can use for spinning up our game genservers. Let's call it <code>GameServer</code>:</p>
<pre class="grvsc-container night-owl" data-language="elixir" data-index="0"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="1"></span><span class="grvsc-source"><span class="mtk3 mtki">defmodule</span><span class="mtk1"> DrawIt.GameServer </span><span class="mtk3 mtki">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="2"></span><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9">use</span><span class="mtk1"> </span><span class="mtk7">GenServer</span></span></span>
<span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="3"></span><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="4"></span><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk6">#</span><span class="mtk6 mtki">#</span></span></span>
<span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="5"></span><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk6">#</span><span class="mtk6 mtki"> Client</span></span></span>
<span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="6"></span><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk6">#</span><span class="mtk6 mtki">#</span></span></span>
<span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="7"></span><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="8"></span><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk3 mtki">def</span><span class="mtk1"> </span><span class="mtk5 mtki">start_link</span><span class="mtk1">(options) </span><span class="mtk3 mtki">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="9"></span><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk7">GenServer</span><span class="mtk1">.start_link(</span><span class="mtk9">__MODULE__</span><span class="mtk1">, options)</span></span></span>
<span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="10"></span><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk3 mtki">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="11"></span><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="12"></span><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk6">#</span><span class="mtk6 mtki">#</span></span></span>
<span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="13"></span><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk6">#</span><span class="mtk6 mtki"> Server</span></span></span>
<span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="14"></span><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk6">#</span><span class="mtk6 mtki">#</span></span></span>
<span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="15"></span><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="16"></span><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk5">@impl</span><span class="mtk1"> </span><span class="mtk7">true</span></span></span>
<span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="17"></span><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk3 mtki">def</span><span class="mtk1"> </span><span class="mtk5 mtki">init</span><span class="mtk1">(options </span><span class="mtk9">\\</span><span class="mtk1"> []) </span><span class="mtk3 mtki">do</span></span></span>
<span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="18"></span><span class="grvsc-source"><span class="mtk1">    {</span><span class="mtk7">:ok</span><span class="mtk1">, %{}}</span></span></span>
<span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="19"></span><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk3 mtki">end</span></span></span>
<span class="grvsc-line"><span class="grvsc-gutter-pad"></span><span class="grvsc-gutter grvsc-line-number" aria-hidden="true" data-content="20"></span><span class="grvsc-source"><span class="mtk3 mtki">end</span></span></span></code></pre>
<p>GenServers are typically divided into two sections: Client and Server. The server section includes methods that implement the various behaviors that are used to build your GenServer. The client methods act as abstractions for invoking our server methods.</p>
<p>This first example is pretty bare-bones.</p>
<ul>
<li>We've created a helper method for clients to easily start a new game server via <code>GameServer.start_link/1</code>.</li>
<li>We've implemented the <code>init/1</code> behavior which will be invoked whenever a new game server is created. Passing an empty map (<code>%{}</code>) as the initial state.</li>
</ul>
<style class="grvsc-styles">
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line > * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: ' ';
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {
    content: ' ';
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .night-owl {
    background-color: #011627;
    color: #d6deeb;
  }
  .night-owl .mtki { font-style: italic; }
  .night-owl .mtk3 { color: #C792EA; }
  .night-owl .mtk1 { color: #D6DEEB; }
  .night-owl .mtk9 { color: #7FDBCA; }
  .night-owl .mtk7 { color: #82AAFF; }
  .night-owl .mtk6 { color: #637777; }
  .night-owl .mtk5 { color: #ADDB67; }
  .night-owl .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
</style></div></section></main><style data-emotion-css="6zvniq">.css-6zvniq{padding:40px;background-color:#011627;color:#FCEFF9;text-align:center;}</style><footer class="css-6zvniq ecvq5430">© <!-- -->2020<!-- --> Cain Watson</footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/managing-game-state-with-elixirs-genserver/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-306a27735be49c7b5cff.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-9663c3f308570e02cbc2.js"],"component---src-pages-404-jsx":["/component---src-pages-404-jsx-f5b5825f90d4e20a6400.js"],"component---src-pages-blog-jsx":["/component---src-pages-blog-jsx-9c86415922f6f045844d.js"],"component---src-pages-index-jsx":["/component---src-pages-index-jsx-3bfd7560819c1d43f2a3.js"],"component---src-templates-blog-post-tsx":["/component---src-templates-blog-post-tsx-763dc3dcbf1587240ee1.js"]};/*]]>*/</script><script src="/component---src-templates-blog-post-tsx-763dc3dcbf1587240ee1.js" async=""></script><script src="/77f58fe8c39316444cad7dcd116feae7c17e2b2a-2b9cfe091b3485bf7db0.js" async=""></script><script src="/app-306a27735be49c7b5cff.js" async=""></script><script src="/framework-5933964352f6dffb280b.js" async=""></script><script src="/webpack-runtime-d2068360cb1b0d995a3e.js" async=""></script></body></html>